<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Produk CV Karya Perikanan Indonesia - Sisik Ikan Kakap Merah, Sisik Ikan Nila, Kulit Ikan. Kualitas Premium untuk Industri Kosmetik & Farmasi">
    <meta name="theme-color" content="#0066B3">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Produk Berkualitas | CV Karya Perikanan Indonesia">
    <meta property="og:description" content="Sisik Ikan Kakap, Sisik Ikan Nila, Kulit Ikan - Berkualitas Premium">
    <meta property="og:image" content="images/logo.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/logo.png">
    
    <title>Produk Kami | CV Karya Perikanan Indonesia</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Language/i18n Dictionary -->
    <script src="js/i18n.js"></script>
</head>
<body>
    <!-- ===================================
         NAVIGATION BAR
         ================================== -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="" class="logo-image">
                <span>CV Karya Perikanan Indonesia</span>
            </a>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html" class="nav-link" data-i18n="nav_home">Beranda</a></li>
                <li><a href="about.html" class="nav-link" data-i18n="nav_about">Tentang Kami</a></li>
                <li><a href="produk.html" class="nav-link active" data-i18n="nav_products">Produk</a></li>
                <li><a href="order.html" class="nav-link" data-i18n="nav_order">Pemesanan</a></li>
                <li><a href="contact.html" class="nav-link" data-i18n="nav_contact">Kontak</a></li>
            </ul>
            
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- ===================================
         PAGE HEADER
         ================================== -->
    <section class="hero" style="padding: 120px 0 80px;">
        <div class="container">
            <div class="hero-content">
                <h1>Produk Kami</h1>
                <p>Produk Berkualitas Premium dari CV Karya Perikanan Indonesia</p>
            </div>
        </div>
    </section>

    <!-- ===================================
         PRODUCTS SECTION
         ================================== -->
    <section class="section">
        <div class="container">
            <div class="section-title">
                <h2 data-i18n="products_page_heading">Produk Unggulan</h2>
                <p data-i18n="products_page_subtitle">Hasil Pengolahan Limbah Perikanan Berkualitas Tinggi</p>
            </div>
            
            <div class="products-grid">
                <!-- Products will be loaded dynamically from Supabase -->
                <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <p style="color: var(--text-gray);" data-i18n="products_loading">Memuat produk...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ===================================
         QUALITY ASSURANCE SECTION
         ================================== -->
    <section class="section" style="background: var(--bg-light);">
        <div class="container">
            <div class="section-title">
                <h2 data-i18n="quality_assurance_title">Jaminan Kualitas</h2>
                <p data-i18n="quality_assurance_subtitle">Komitmen Kami terhadap Standar Mutu Tinggi</p>
            </div>
            
            <div class="vm-grid">
                <div class="vm-card">
                    <div class="icon">üîç</div>
                    <h3 data-i18n="quality_material_selection">Seleksi Bahan Baku</h3>
                    <p style="color: var(--text-gray); line-height: 1.8; margin-top: 15px;" data-i18n="quality_material_desc">
                        Setiap bahan baku melalui proses seleksi ketat dari pemasok terpercaya. 
                        Kami hanya menggunakan sisik dan kulit ikan dari sumber berkualitas 
                        untuk memastikan produk akhir yang optimal.
                    </p>
                </div>
                
                <div class="vm-card">
                    <div class="icon">üßº</div>
                    <h3 data-i18n="quality_washing">Proses Pencucian</h3>
                    <p style="color: var(--text-gray); line-height: 1.8; margin-top: 15px;" data-i18n="quality_washing_desc">
                        Proses pencucian dilakukan dengan air bersih dan sanitasi yang tepat. 
                        Setiap produk dicuci hingga benar-benar bersih dari kotoran dan bau 
                        amis untuk menjamin higienitas.
                    </p>
                </div>
                
                <div class="vm-card">
                    <div class="icon">‚òÄÔ∏è</div>
                    <h3 data-i18n="quality_drying">Pengeringan Modern</h3>
                    <p style="color: var(--text-gray); line-height: 1.8; margin-top: 15px;" data-i18n="quality_drying_desc">
                        Menggunakan teknologi pengeringan modern dengan kontrol suhu dan 
                        kelembaban yang tepat. Proses ini memastikan produk kering sempurna 
                        dan tahan lama tanpa mengurangi kualitas.
                    </p>
                </div>
                
                <div class="vm-card">
                    <div class="icon">üì¶</div>
                    <h3 data-i18n="quality_packaging">Pengemasan Higienis</h3>
                    <p style="color: var(--text-gray); line-height: 1.8; margin-top: 15px;" data-i18n="quality_packaging_desc">
                        Produk dikemas dalam kemasan kedap udara dan higienis untuk menjaga 
                        kualitas dan kesegaran. Label lengkap dengan informasi produk dan 
                        tanggal produksi.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ===================================
         PRODUCT BENEFITS SECTION
         ================================== -->
    <section class="section">
        <div class="container">
            <div class="section-title">
                <h2 data-i18n="product_benefits_title">Manfaat Produk</h2>
                <p data-i18n="product_benefits_subtitle">Nilai Ekonomi Tinggi dari Limbah Perikanan</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon">üíé</div>
                    <h4 data-i18n="product_benefits_collagen">Kolagen Alami</h4>
                    <p data-i18n="product_benefits_collagen_desc">Sisik ikan mengandung kolagen berkualitas tinggi untuk industri kosmetik dan kesehatan</p>
                </div>
                
                <div class="stat-card">
                    <div class="icon">üß™</div>
                    <h4 data-i18n="product_benefits_research">Bahan Penelitian</h4>
                    <p data-i18n="product_benefits_research_desc">Ideal untuk penelitian biomedis, farmasi, dan pengembangan produk baru</p>
                </div>
                
                <div class="stat-card">
                    <div class="icon">üå±</div>
                    <h4 data-i18n="product_benefits_eco">Ramah Lingkungan</h4>
                    <p data-i18n="product_benefits_eco_desc">Memanfaatkan limbah perikanan menjadi produk bernilai ekonomi</p>
                </div>
                
                <div class="stat-card">
                    <div class="icon">üè≠</div>
                    <h4 data-i18n="product_benefits_industry">Aplikasi Industri</h4>
                    <p data-i18n="product_benefits_industry_desc">Dapat digunakan dalam berbagai industri dari pakan hingga kerajinan</p>
                </div>
                
                <div class="stat-card">
                    <div class="icon">üí™</div>
                    <h4 data-i18n="product_benefits_protein">Protein Tinggi</h4>
                    <p data-i18n="product_benefits_protein_desc">Kandungan protein tinggi cocok untuk pakan ternak berkualitas</p>
                </div>
                
                <div class="stat-card">
                    <div class="icon">‚úÖ</div>
                    <h4 data-i18n="product_benefits_quality">Kualitas Konsisten</h4>
                    <p data-i18n="product_benefits_quality_desc">Standar kualitas yang konsisten di setiap batch produksi</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ===================================
         ORDER INFO SECTION
         ================================== -->
    <section class="section" style="background: var(--bg-light);">
        <div class="container">
            <div class="section-title">
                <h2 data-i18n="order_info_title">Informasi Pemesanan</h2>
                <p data-i18n="order_info_subtitle">Cara Mudah Memesan Produk Kami</p>
            </div>
            
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-image" style="background: var(--light-blue); height: 200px;">
                        <span style="font-size: 4rem;">üì±</span>
                    </div>
                    <div class="product-info">
                        <h3 data-i18n="order_step_1_title">1. Hubungi Kami</h3>
                        <p data-i18n="order_step_1_desc">
                            Hubungi kami melalui WhatsApp di nomor 0878-0822-8699 atau gunakan 
                            formulir pemesanan di halaman order.
                        </p>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-image" style="background: var(--light-blue); height: 200px;">
                        <span style="font-size: 4rem;">üìã</span>
                    </div>
                    <div class="product-info">
                        <h3 data-i18n="order_step_2_title">2. Konfirmasi Pesanan</h3>
                        <p data-i18n="order_step_2_desc">
                            Tim kami akan mengkonfirmasi ketersediaan produk dan detail pesanan Anda dalam waktu singkat.
                        </p>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-image" style="background: var(--light-blue); height: 200px;">
                        <span style="font-size: 4rem;">üí≥</span>
                    </div>
                    <div class="product-info">
                        <h3 data-i18n="order_step_3_title">3. Pembayaran</h3>
                        <p data-i18n="order_step_3_desc">
                            Lakukan pembayaran sesuai dengan instruksi yang diberikan oleh tim kami.
                        </p>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image" style="background: var(--light-blue); height: 200px;">
                        <span style="font-size: 4rem;">üöö</span>
                    </div>
                    <div class="product-info">
                        <h3 data-i18n="order_step_4_title">4. Pengiriman</h3>
                        <p data-i18n="order_step_4_desc">
                            Produk akan dikemas dengan baik dan dikirimkan ke alamat Anda sesuai jadwal yang disepakati.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===================================
         CALL TO ACTION SECTION
         ================================== -->
    <section class="section" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%); color: white;">
        <div class="container">
            <div style="text-align: center; max-width: 800px; margin: 0 auto;">
                <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: white;" data-i18n="cta_interested">Tertarik dengan Produk Kami?</h2>
                <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.95;" data-i18n="cta_subtitle">
                    Dapatkan penawaran terbaik untuk pemesanan dalam jumlah besar. Hubungi kami 
                    sekarang untuk konsultasi gratis tentang kebutuhan Anda.
                </p>
                <div class="hero-buttons">
                    <a href="order.html" class="btn btn-light" data-i18n="cta_order">Pesan Sekarang</a>
                    <a href="contact.html" class="btn btn-secondary" data-i18n="cta_contact">Hubungi Kami</a>
                </div>
            </div>
        </div>
    </section>

    <!-- ===================================
         FOOTER
         ================================== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <h3 id="footerCompanyName">CV Karya Perikanan Indonesia</h3>
                    <p id="footerCompanyDesc" data-i18n="footer_company_desc">
                        Perusahaan pengolahan limbah perikanan yang berkomitmen menghasilkan 
                        produk berkualitas tinggi dengan standar kebersihan dan mutu terjaga.
                    </p>
                </div>
                
                <div class="footer-links">
                    <h4 data-i18n="footer_menu_title">Menu Cepat</h4>
                    <ul>
                        <li><a href="index.html" data-i18n="footer_home">Beranda</a></li>
                        <li><a href="about.html" data-i18n="footer_about">Tentang Kami</a></li>
                        <li><a href="produk.html" data-i18n="footer_products">Produk</a></li>
                        <li><a href="order.html" data-i18n="footer_order">Pemesanan</a></li>
                        <li><a href="contact.html" data-i18n="footer_contact_link">Kontak</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h4 data-i18n="footer_contact_title">Kontak</h4>
                    <p id="footerAddress"><i class="fas fa-map-marker-alt"></i> <span>Gunung Calincing, Kuripan, Kec. Ciseeng, Kabupaten Bogor, Jawa Barat 16120</span></p>
                    <p id="footerPhone"><i class="fas fa-phone"></i> <span>0878-0822-8699</span></p>
                    <p id="footerHours"><i class="fas fa-clock"></i> <span>Buka 24 Jam</span></p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 CV Karya Perikanan Indonesia. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript (Loaded first to initialize Supabase) -->
    <script src="js/script.js"></script>

    <!-- Load Products from Supabase -->
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const productsGrid = document.querySelector('.products-grid');
            
            if (!productsGrid) {
                console.warn('Products grid not found on this page');
                return;
            }

            // Wait for Supabase client to be ready (max 5 seconds)
            let retries = 0;
            while (!window.supabaseClient && retries < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                retries++;
            }

            // Verify Supabase client is ready
            if (!window.supabaseClient) {
                console.error('‚ùå Supabase client not initialized after 5 seconds');
                productsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><p style="color: red;">Error: Supabase client tidak tersedia.</p></div>';
                return;
            }

            console.log('üîÑ Fetching products from Supabase...');

            try {
                // Fetch products from Supabase
                const { data: products, error } = await window.supabaseClient
                    .from('products')
                    .select('*')
                    .eq('available', true);

                if (error) {
                    console.error('‚ùå Supabase query error:', error);
                    console.error('Error details:', {
                        message: error.message,
                        details: error.details,
                        hint: error.hint,
                        code: error.code
                    });
                    throw error;
                }

                // Clear loading message
                productsGrid.innerHTML = '';

                // Check if products exist
                if (!products || products.length === 0) {
                    const emptyMsg = i18n[currentLang]?.products_no_available || 'Belum ada produk tersedia.';
                    productsGrid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><p style="color: var(--text-gray);">${emptyMsg}</p></div>`;
                    return;
                }

                // Render each product
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';

                    // Get language-specific fields
                    const isEnglish = currentLang === 'en';
                    const productName = isEnglish && product.name_en ? product.name_en : product.name;
                    const productDesc = isEnglish && product.description_en ? product.description_en : product.description;

                    // Handle image
                    let imageHTML = '';
                    if (product.image_url && product.image_url.trim() !== '') {
                        imageHTML = `<img src="${product.image_url}" alt="${productName}" style="width: 100%; height: 100%; object-fit: cover;">`;
                    } else {
                        // Default placeholder if no image
                        imageHTML = `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #E6F2FF 0%, #B3D9FF 100%); display: flex; align-items: center; justify-content: center; font-size: 6rem;">üêü</div>`;
                    }

                    // Escape HTML to prevent XSS
                    const escapeName = productName ? productName.replace(/</g, '&lt;').replace(/>/g, '&gt;') : (isEnglish ? 'Product' : 'Produk');
                    const escapeDesc = productDesc ? productDesc.replace(/</g, '&lt;').replace(/>/g, '&gt;') : (i18n[currentLang]?.product_default_desc || 'Produk berkualitas tinggi dari CV Karya Perikanan Indonesia.');
                    const specLabel = isEnglish ? 'Specifications:' : 'Spesifikasi:';
                    const usesLabel = isEnglish ? 'Uses:' : 'Kegunaan:';
                    const orderBtnText = i18n[currentLang]?.order_now || 'Pesan Sekarang';
                    
                    // Build specifications section if available
                    let specificationsHTML = '';
                    const specsData = isEnglish && product.specifications_en ? product.specifications_en : product.specifications;
                    if (specsData) {
                        try {
                            const specs = typeof specsData === 'string' 
                                ? JSON.parse(specsData) 
                                : specsData;
                            
                            if (Array.isArray(specs) && specs.length > 0) {
                                const specItems = specs.map(spec => 
                                    `<li style="padding: 5px 0; color: var(--text-gray);">‚úì ${spec.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`
                                ).join('');
                                
                                specificationsHTML = `
                                    <div style="margin: 15px 0; padding: 15px; background: var(--light-blue); border-radius: 8px;">
                                        <h4 style="color: var(--primary-blue); margin-bottom: 10px; font-size: 1.1rem;">${specLabel}</h4>
                                        <ul style="list-style: none; padding: 0;">
                                            ${specItems}
                                        </ul>
                                    </div>
                                `;
                            }
                        } catch (e) {
                            console.warn('Could not parse specifications for product:', productName);
                        }
                    }

                    // Build uses section if available
                    let usesHTML = '';
                    const usesData = isEnglish && product.uses_en ? product.uses_en : product.uses;
                    if (usesData) {
                        try {
                            const uses = typeof usesData === 'string' 
                                ? JSON.parse(usesData) 
                                : usesData;
                            
                            if (Array.isArray(uses) && uses.length > 0) {
                                const useItems = uses.map(use => 
                                    `<li style="padding: 5px 0; color: var(--text-gray);">‚Ä¢ ${use.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`
                                ).join('');
                                
                                usesHTML = `
                                    <div style="margin: 15px 0; padding: 15px; background: var(--bg-light); border-radius: 8px;">
                                        <h4 style="color: var(--primary-blue); margin-bottom: 10px; font-size: 1.1rem;">${usesLabel}</h4>
                                        <ul style="list-style: none; padding: 0;">
                                            ${useItems}
                                        </ul>
                                    </div>
                                `;
                            }
                        } catch (e) {
                            console.warn('Could not parse uses for product:', productName);
                        }
                    }

                    productCard.innerHTML = `
                        <div class="product-image">
                            ${imageHTML}
                        </div>
                        <div class="product-info">
                            <h3>${escapeName}</h3>
                            <p>${escapeDesc}</p>
                            ${specificationsHTML}
                            ${usesHTML}
                            <a href="order.html" class="btn btn-primary" style="width: 100%; text-align: center;">${orderBtnText}</a>
                        </div>
                    `;

                    productsGrid.appendChild(productCard);
                });

                console.log(`‚úÖ Loaded ${products.length} products from Supabase`);

            } catch (error) {
                console.error('‚ùå Error loading products:', error);
                console.error('Full error object:', error);
                
                // Detailed error message
                let errorMessage = (i18n[currentLang]?.products_error || 'Gagal memuat produk. ');
                if (error.message) {
                    errorMessage += `Error: ${error.message}`;
                }
                if (error.hint) {
                    errorMessage += ` Hint: ${error.hint}`;
                }
                
                console.error('Error message:', errorMessage);
                
                // Show error message to user
                const refreshText = i18n[currentLang]?.products_loading ? 'Please refresh the page.' : 'Silakan refresh halaman.';
                productsGrid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <p style="color: red; margin-bottom: 10px;">${errorMessage}</p>
                    <p style="color: var(--text-gray); font-size: 0.9rem;">Lihat console untuk detail error (tekan F12).</p>
                </div>`;
            }
        });
    </script>
</body>
</html>
